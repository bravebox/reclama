/* jQuery.my 1.1.9
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */
!function(e){function t(){window.console&&console.error.apply(console,arguments)}function r(){window.console&&console.log.apply(console,arguments)}function n(e,t){return(P(t)?t.split("."):R(t)?t:[""]).reduce(function(e,t){if(null!=e){if(/=/.test(t)){var r=t.split("=",2);return $(e)?Object.values(e).find(function(e){return $(e)||R(e)?e[r[0]]==r[1]:!1}):R(e)?e.find(function(e){return $(e)||R(e)?e[r[0]]==r[1]:!1}):void 0}if(null!=e&&null!=e[t])return e[t]}return void 0},e)}function i(e,t){var r,i;if($(t))return t;if(P(t)){if(r=n(e,t),null==r&&(r=Object.clone(H._src[t],!0)),null==r&&(r=n(H,t),$(r)&&$(r._self)?r=Object.clone(r._self,!0):$(r)&&(r=Object.clone(r,!0))),null==r&&n(e,"params.cache")&&(i=n(e,"params.cache"),A(i)?r=i(t):$(i)&&(r=at(t,i)),$(r)&&($(r._self)&&(r=Object.clone(r._self,!0)),Object.merge(r,{params:{cache:i}},!0))),null!=r&&$(r))return i=i||n(e,"params.cache"),i&&Object.merge(r,{params:{cache:i}},!0),r;throw"Component "+t+" not found."}return A(t)?t.apply(e,Array.prototype.slice.call(arguments,2)):null}function a(r,i){var a,s,l,c,u,d=i||H,f=r;if(!($(d)&&$(f)&&$(f.ui)&&P(f.id)))return"Can’t save manifest into cache, invalid arguments.";d.hasOwnProperty("_src")||(d._src={}),l=f.id;try{f=Object.clone(r,!0)}catch(m){return"Can’t save circular-referencing object into cache."}try{(!f.params||f.params&&!f.params.strict)&&w(f,!0)}catch(m){return"Invalid manifest, parse error."}if(a=o(f),P(a))return t(a),a;if(Object.merge(f,{params:{strict:!0}},!0),d._src[l]=f,c=lt.mask(d,l)){if(c.params&&c.params.protect)return"Can’t save manifest into cache over protected one.";c._self&&delete c._self,e.extend(!0,d,lt.unmask("",l))}return e.extend(!0,d,lt.unmask(f,l)),s=Object.keys(d._src).filter(function(e){return e.startsWith(l+".")}),s.sort(),s.forEach(function(t){var r;(r=lt.mask(d,t))&&(r._self&&delete r._self,e.extend(!0,d,lt.unmask("",t))),e.extend(!0,d,lt.unmask(d._src[t],t))}),u=n(d,l),M?u._self=d._src[l]:Object.defineProperty(u,"_self",{get:function(){return d._src[l]},set:function(){throw"Can’t change manifest cache entry directly."},enumerable:!1,configurable:!0}),u}function o(e){var t,r,n=[];if($(e.files)&&Object.size(e.files))for(t in e.files){if(r=e.files[t],!$(r))return"Non-object member "+t+" in files section.";if(P(r.data)&&!r.url)if(E)try{lt.base642blob(r.data,function(e){r.blob=e,r.url=E.createObjectURL(r.blob)},r.content_type||r.mime),n.push(t)}catch(i){return"Invalid base64 data in files/"+t+"."}else r.url="data:"+(r.content_type||r.mime)+";base64,"+r.data,n.push(t)}return n}function s(r,n){$(n)&&n.channel&&n.message&&r.find(".my-listen-"+lt.sdbmCode(n.channel)).each(function(){var r,i=e(this),a=i.data("my"),o=void 0;if(a&&a.ui.listen&&A(a.ui.listen[n.channel])){r=a.ui.listen[n.channel];try{o=r.call(a.manifest||a.root.my().manifest,a.data,n.message,i)}catch(s){t("Listener failed",s.message,s.stack)}void 0!==o&&(null===o?i.trigger("check"):o&&i.trigger("recalc"))}})}function l(t,r){function i(t,r){var n;return P(t)?/[\/]/.test(t)?(n=B(!0,{},k,{ref:r,ajax:{url:t}}),nt.test(r)&&(n.ajax.dataType="json")):t.length&&(n=B(!0,{},k,{ref:r,ajax:t})):$(t)&&(n=B(!0,{},k,{ref:r,ajax:e.extend(!0,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username","headers"]))}),n.ajax.url||(n=null)),n}function a(){g.reject(w)}function o(){O+=1;var e=b[O];if(e)s(e).then(o).fail(a);else{var r=c(x),n=L(Object.findAll(r,function(e,t){return!t}));n.length&&w.push((1===n.length?"Key "+n[0]+" is":"Keys "+n.join(", ")+" are")+" not present after all."),w.length?a():g.resolve(t)}}function s(r){function n(){c-=1,s?l.reject():.5>c&&l.resolve()}var i,a,o,s=!1,l=e.Deferred(),c=r.length;for(a=0;c>a;a++)i=r[a],o=P(i.ajax)?j.loader:ot,o(i.ajax).then(function(e,r){nt.test(r.ref)&&(null!=e?B(!0,t,lt.unmask(e,r.ref.from(5))):(s=!0,w.push("Invalid data for ‘"+r.ref+"’ resource."))),n()}.fill(void 0,i)).fail(function(e,t){w.push("Failed to load ‘"+t.ref+"’ resource."),s=!0,n()}.fill(void 0,i));return l.promise()}function l(e){var r=!1;return nt.test(e)?null!=n(t,e.from(5))&&(r=!0):null!=n(window,e)&&(r=!0),r}function c(e){for(var t in e)e[t]===!1&&(e[t]=l(t));return e}var u,d,f,m,h,p,y,v,g=e.Deferred(),b=[],x={},w=[],j=B(!0,{ajaxTimeout:1e4,loader:st.params.loader},r||{}),k={ref:null,ajax:{type:"GET",async:!0,timeout:j.ajaxTimeout}};if($(t))if(R(t.require)){for(m=t.require,u=0;u<m.length;u++)if(h=m[u],P(h))x[h]=l(h);else if($(h)){v=[];for(d in h){if(p=null,h[d]===!0)x[d]=l(d);else if(P(h[d])||$(h[d]))p=i(h[d],d);else if(R(h[d])){for(p=[],f=0;f<h[d].length;f++)(P(h[d][f])||$(h[d][f]))&&(y=i(h[d][f],d),y&&p.push(y));p.length||(p=null)}p&&!(x[d]=l(d))&&v.add(p)}v.length&&b.push(v)}var O=-1;o()}else g.resolve(t);else g.reject(["Invalid manifest."]);return g.promise()}function c(e,t){var r,n,i=e.data("myval");return i||(n=u(e,st.vals),A(n)&&(r=n(e,W),void 0===r?e.data("myval",function(e,t){return W!=t&&n(e,t),e.val()}.fill(e,void 0)):e.data("myval",n.fill(e,void 0))),i=e.data("myval")),A(i)?(r=i(),(r!==t&&(0==t||0==r)||r!=t||$(t))&&(r=i(t)),r):W}function u(e,t){function r(e,t,o){for(var s in t)if(""!=s&&e.is(s)){a=a+(a?" ### ":"")+s;var l=t[s],c=Q(l);if(!/^(nul|un|ob)/.test(c)&&o>i)return n=l,void(i=o);c==G&&r(e,l,o+1)}W!=t[""]&&typeof t[""]!=G&&o>i&&(n=t[""],i=o)}var n=W,i=0,a="";return r(e,t,1),n}function d(e,t,r,n){var i,a,o,s=[],l=r.bind,c=Q(l);if(c==tt)return l.call(m(n).manifest,e,t,n);if(c===et||c===Z){if(c===et&&!/\./.test(l))return t!=W?e[l]=t:void 0===e[l]&&(e[l]=W),e[l];for(c===et&&(s=l.split(".").each(function(e,t){this[t]=e+""})),c===Z&&(s=l.slice(0).each(function(e,t){this[t]=e+""})),"this"===s[0]?(a=m(n).manifest,s.shift()):a=e,i=0;i<s.length;i++){if(i===s.length-1)return t!=W?a[s[i]]=t:void 0===a[s[i]]&&(a[s[i]]=W),a[s[i]];0==i?(o=a,a=a[s[0]]):(o=o[s[i-1]],a=a[s[i]]),void 0===a&&(a=o[s[i]]={})}}return W}function f(t,r,n,i){var a,o,s=n.check;if(s!=W){var l=m(i).params.messages,c=n.error,u=c||l.patternMismatch||l[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var d=i[0].validationMessage+"";if(""!==d)return d.substr(0,1).toUpperCase()+d.substr(1);o=i[0].validity;for(a in o)""===d&&"valid"!=a&&I(o[a])&&o[a]&&l[a]&&(d=l[a]);return d||c}switch(Q(s).to(1)){case"f":return h=s.call(m(i).manifest,t,r,i),null===h||void 0===h?"":h;case"r":return s.test(String(r))?"":u;case"a":return s.indexOf(r)>-1?"":u;case"s":return r==s?"":u;case"o":return s[r]?"":u;case"b":if(i.is(".my-form-list,.ui-sortable")){var f=i.data("listSrc")||i.data("my").listSrc||">*",h={};return i.find(f).filter("*:not(.ui-sortable-placeholder)").each(function(t){var r=e(this);r.data("my")&&!r.my("valid")&&(h[t]=r.my("errors"))}),h}return i.hasClass("my-form")&&s?i.my("valid")?"":i.my("errors"):""}return l.formError||"Error"}return""}function m(e){var t=e.my();return t?t.root?t.root.my():t:null}function h(t,r,n){var i=n.compact(),a=i.replace(/:disabled/g,""),o=a!==i,s="self:"===a.to(5);return s&&(a=a.replace(/^self:/g,"")),r.each(function(){var n=e(this),i=n.my(),l=!s&&i?i.container:n;l.toggleClass(a,!!t),o&&void 0!==i&&!!t!=!!i.disabled&&(n.my().disabled=!!t,i._disable||(n.my()._disable=u(r,st.offon).fill(void 0,r)),i._disable(!!t))}),r}function p(e,r,n){var i,a,o,s,l,u,m,y,v,g,b,x,w=!1,j=!1,k=e,O=k.my(),C="";if(O){if(v=O.selector,g=O.root,g.hasClass("my-form-init"))return{};if(b=g.find(v),x=g.my().ui,w=e.hasClass("my-form"),j=e.hasClass("my-form-list"),w?(a=e,o=O.ddata,s=O.dui,l=O.dparams):(a=O.container,o=O.data,s=O.ui,l=O.params),s.bind!=W){if(u=V(r)?r:c(b,d(o,W,s,b)),W!=s.check){C="Unknown error";try{C=f(o,u,s,b)}catch(q){t("Error "+q.message+" in .check validator for "+v,g,q.stack)}}var z=l.errorCss,D="ui-state-error";try{W!=r&&(u=c(b,d(o,r,s,b)))}catch(q){C=l.messages.formError||"Error"}if(""===C)w?O.derrors[v]="":O.errors[v]="",a.removeClass(z),a.attr("title")&&a.attr("title",""),w||j||l.effect(a.find(l.errorTip),!1,l.animate/2),k.removeClass(D),k.find(".ui-widget").removeClass(D);else{if(w)O.derrors[v]=C;else if(j)O.errors[v]=C;else{a.addClass(z),O.errors[v]=C;var N=a.find(l.errorTip).eq(0);N.size()?l.effect(N.addClass(z).html(C),!0,l.animate):a.attr("title",(C||"").stripTags())}k.is(".hasDatepicker")&&(k.is("input")?k.addClass(D):k.find(".ui-widget").addClass(D)),k.is(".ui-slider")&&k.addClass(D)}}var _=r==W?u:r;if(s.css)for(m in s.css)y=s.css[m],U(y)?h(y.test(_),b,m):A(y)&&h(y.call(g.my().manifest,o,_,b),b,m);var i,T,S=s.recalc,E=[],M={};if(n&&s.recalc&&g.my()){for(x=g.my().ui,i=0;i<S.length;i++)S[i]&&P(S[i])&&(T=S[i].compact())&&x[T]&&(x[T].recalc?-1===E.indexOf(T)&&E.push(T):M[T]=!0);for(i=0;i<E.length;i++)M=B(!0,M,p(g.find(E[i]),W,n-1));if(r!==W){for(i in M)M[i]===!0&&i!=v&&(x[i].delay&&!x[i].recalc?x[i]._update(g.find(i),W,n-1):p(g.find(i),W,n-1));return{}}}return M||{}}}function y(e,t,r,n){var i,a,o,s,l,c,u,d,f,m=t;if(!$(m)||isNaN(s=m.remember)||!$(i=m.history))return W;if($(e)&&s){if(c=Object.clone(e,!0),u=Date.now(),o=L(i).sort(),o.length&&(u-o.last()<m.historyDelay||Object.equal(i[o.last()],c)))return W;if(m.history[u]=c,o.push(u),o.length>=2*s){for(f={},a=s;2*s>a;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(rt),m.history[o.last()]}if(!isNaN(e)||e===W){if(l=parseInt(e)||0,0>l)return W;if(o=L(i).sort(),l>=o.length&&(l=o.length-1),d=Object.clone(m.history[o[o.length-l-1]],!0),r){for(f={},a=0;a<o.length-l-1;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(rt),d}return n||m.form.trigger(rt),W}function v(a,o,s,l){function c(){var t=null,r=C.manifest;if(A(r)||$(r)&&$(r.ui)?w=r:P(r)&&(w=i(D,r.replace(nt,""))),w&&P(C.bind)){var o=n(nt.test(C.bind)?D:k.data,C.bind.replace(nt,""));if(null===q&&(q=e.Deferred()),R(o)||C.list){a.addClass("my-form-list");var s="",c=">*";if(/^<.+>$/.test(C.list)?s=C.list:c=C.list||c,!s){var u=a.find(c);s="<div></div>",u.size()&&(s=e(s).append(u.eq(0).clone(!0)).html(),u.eq(0).remove())}a.data("formlist")||a.data("formlist",{}),a.data("formlist").generator={manifest:w,delay:(C.delay||O.delay||10)/1.3,template:s,selector:c,parent:D,bind:C.bind,hash:A(C.hash)?C.hash.bind(D):P(C.hash)?f.fill(void 0,C.hash):R(C.hash)?m.fill(void 0,C.hash.slice(0)):null,id:A(C.id)?C.id.bind(D):P(C.id)?f.fill(void 0,C.id):R(C.id)?m.fill(void 0,C.id.slice(0)):null,ext:!(!C.id&&!C.hash),stamp:0},a.on("insert.my",function(t,r){t.stopPropagation();var n={what:void 0,where:0};null==r?n.where=1e6:$(r)?Object.merge(n,r):(P(r)||F(r))&&(n.where=r),e(t.target).my("insert",n.where,n.what)}),a.on("remove.my",function(t){t.stopPropagation(),e(t.target).my("remove")})}else try{t=a.my(i(D,w),$(o)?o:void 0)}catch(p){d("$.my subform init of "+l+" failed: "+p.message,p.stack)}}it(t)?t.then(h,function(e,t){d("Init of subform "+l+" failed with error: "+e,t)}):h()}function d(e,r){t(e,r),q&&q.reject(e,r)}function f(e,t){var r=n(e,t)||"";return"string"==typeof r?r:lt.sdbmCode(r)}function m(e,t){return lt.sdbmCode(lt.mask(e,t))}function h(){a.each(function(){var t,r,n,i=e(this),c=!1;if("TEXTAREA"==i[0].nodeName&&(n=i[0].nextSibling,r=n&&n.CodeMirror?n.CodeMirror:null,r&&i.addClass("my-codemirror")),t=C.events||u(i,st.events),i.is(".my-form")?B(i.data("my"),{dui:C,root:o,selector:l,dparams:O,devents:t,ddata:k.data,container:O.container(i),derrors:k.errors}):(i.data("my",{events:t,selector:l,initial:v,previous:v,root:o,container:O.container(i),id:k.id,ui:C,data:k.data,params:O,errors:k.errors}),s._update=C.delay?p.debounce(C.delay):W,c=!0),c)if(i.cleditor&&i.parent().is(".cleditorMain")){var d=i.cleditor()[0];if(d&&d.$frame&&d.$frame[0]){i.addClass("my-cleditor"),B(i.data("my"),{container:O.container(i)});var f,m=function(e){i.val(e).trigger(rt)},h=Number.random(1e5,1e6-1);e(d.$frame[0]).attr("id","cleditCool"+h),f=document.frames?document.frames["cleditCool"+h].document:e("#cleditCool"+h)[0].contentWindow.document;var y=e(f).find("body");e(f).bind("keyup.my",function(){m(e(this).find("body").html())}),i.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){m(y.html())}),e("body").on("click","div.cleditorPopup",function(){m(y.html())})}}else if(i.is("div.redactor_box textarea")){var x,w="my-redactor-9";try{x=i.getEditor(),w="my-redactor-8"}catch(q){x=i.redactor("getEditor")}x&&(i.addClass(w),x.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(i)))}else i.is(".ace_editor")?ace.edit(a[0]).on(rt,function(e){e.trigger("ace")}.fill(i)):r&&r.on(rt,function(e){e.trigger("codemirror")}.fill(i));i.my()._changed=g.debounce(j),i.my()._recalc=b.debounce(j),i.bind(t,function(e){e.type==rt&&e.stopPropagation(),c&&(k.locktill=Date.now()+s.delay),i.my()._changed(i,o,s,O)}),/check(\.my)?/.test(t+"")||i.on("check.my",function(){return i.my()._changed(i,o,s,O,!0),!1}),c||i.off("redraw.my"),i.on("recalc.my, redraw.my",function(e){e.stopPropagation(),i.my()._recalc(i,o,s,O)})}),q&&q.resolve()}var y,v,w,j,k=o.my(),O=(k||{}).params,C=s,q=null,z=0,D=k.manifest;return k?(j=s.delay,a.size()?(C.init!=W&&(y=x(D,C.init,a,k)),it(y)?(z+=1,q=e.Deferred(),y.then(c,function(e,t){d("Init of "+l+" failed: "+e,t)})):c()):r("Not found "+l+" selector.",o),q):(t("Failed to find $root building "+l+" selector."),null)}function g(e,t,r,n,i){var a=e.data("my"),o=t.data("my");if(a&&!a.disabled){y(a.ddata||a.data,a.dparams||a.params);var s=t.find(a.selector);p(e,i?W:c(s,W),r.recalcDepth||n.recalcDepth),void 0===o.orphan&&a.root.parent().hasClass("ui-sortable")&&(o.orphan=!a.root.parent().hasClass("my-form-list")),o.orphan&&a.root.parent().trigger("check"),n.change&&n.change.call(e)}}function b(e,t,r,i){var a=e.my();if(a&&!a.disabled){var o=t.find(a.selector);o.is(".my-form")?o.my("redraw"):p(e,o.is(".my-form-list")?n(o.my().data,o.data("formlist").generator.bind):W,r.recalcDepth||i.recalcDepth)}}function x(e,t,r,i){var a;if(P(t)){if(a=n(e,t),void 0===a)return r.html(t.assign(i.data)),null}else a=t;if(A(a))return a.apply(e,Array.prototype.slice.call(arguments,2));if(R(a))try{r.formgen(a)}catch(o){}return null}function w(e,t){var r,n=!t;for(r in e)e.hasOwnProperty(r)&&j(r,e,n)}function j(e,r,n){var i,a,o,s,l="";(n||!/^(data|files|require)$/.test(e))&&(i=r[e],l=Q(i),/^(ob|ar)/.test(l)?w(i):"string"===l&&/^(function[\s\n\t]+|new\sRegExp)/.test(i)&&((a=i.match(/^function([\s\n\t]+[\w_$][\w\d_$]*)?[\s\n\t]*\(([^\)]*)\)\s*\{([\s\S]*)\}[\s\n\r\t]*$/))&&4===a.length?(s=a[1]?a[1].replace(/[\s\n\t]/g,""):"",o=s.length?O(s,a[2],a[3]):k(a[2],a[3]),"function"==typeof o?r[e]=o:t("Invalid function in XJSON, skipped",o.message,o.stack,i)):(a=i.match(/^new\sRegExp\s*\(\/([\s\S]+)\/([a-z]*)\)$/))&&3===a.length&&(o=C(a[1],a[2]),"function"==typeof o.test?r[e]=o:t("Invalid RegExp in XJSON, skipped",o.message,o.stack,i))))}function k(e,t){var r;try{r=new Function(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function O(e,t,r){var n;try{n=new Function("","return (function "+e+"("+t+"){"+r+"});")()}catch(i){n={message:i.message,stack:i.stack}}return n}function C(e,t){var r;try{r=new RegExp(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function q(e,t,r){var i=$(t)?t:null;return Object.each(e,function(t,r){var n=typeof r;/^str|^fu/.test(n)&&(e[t]={bind:r})}),Object.each(e,function(t,a){var o,s,l,c=[],u=[],d=/\s?[,;]\s?/;a.recalc&&(P(a.recalc)?c=a.recalc.split(d):R(a.recalc)&&(c=a.recalc),c=c.compact(!0).unique()),c.length&&(e[t].recalc=c),null==a.bind&&(a.bind=function(){});var f;if(a.listen&&(f=z(a.listen),a.listen=Object.size(f)?f:void 0),a.hasOwnProperty("watch"))for(P(a.watch)?u=a.watch.split(d):R(a.watch)&&(u=a.watch.slice(0)),u=u.compact(!0).unique(),l=0;l<u.length;l++)(o=e[u[l]])&&(s=o.recalc,s?P(s)?o.recalc+=","+t:R(s)&&-1==s.indexOf(t)&&o.recalc.push(t):o.recalc=[t]);null!==i&&["css","check","manifest","list","hash","id"].each(function(e){if(P(a[e])){var t=n(i,a[e].replace(nt,""));null==t||P(t)||(a[e]=t)}}),a.delay=isNaN(a.delay)?r.delay:a.delay-0}),e}function z(e){var t,r={},n=function(){return null};if(P(e))e.split(/[,\s]+/).compact(!0).unique().map(function(e){r[e]=n});else if(R(e))e.compact(!0).unique().map(function(e){r[e]=n});else if($(e))for(t in e)r[t]=A(e[t])?e[t]:function(){return e[t]};return r}function D(e){var t,r=e,n={};if(P(r)&&(r=r.split(/[,\s]+/)),R(r)){for(r=r.compact(!0),t=0;t<r.length;t++)n[r[t]]=!0;return n}return $(r)?e:null}function N(e,t){function r(i,a,o,s){var l,c,u,d,f=i;if(P(f)&&(/[\r\n]/.test(f)||f.split("}",3).length>2?f=lt.css2json(f):o.push(a+(/\{/.test(f)?f:"{"+f+"}"))),R(f)&&f.length)for(l=0;l<f.length;l++)r(f[l],a,o,s);else if($(f))for(l in f)for(d=n(a,l),c=0;c<d.length;c++)r(f[l],d[c],o,s);else if(A(f))try{u=f.call(t,e,t),r(u,a,s,s)}catch(m){}}function n(e,t){var r,n="",i=t+"";return(" "===i.to(1)||/^[a-z]/i.test(i))&&(n=" "),r=i.split(/\s*,\s*/).compact(!0),r.length||r.push(""),r.map(function(t){return e+n+t})}var i=[],a=[],o=t;return $(o)&&$(o.style)?(r(t.style,"",i,a),[i,a]):""}function _(){return{con:r,clone:function(e){return e.clone?e.clone():e},extval:function(e){var t=e.my();return t&&t.data?t.data:e.data("value")||e.val()||e.text()||e.html()||""},jquix:function(e,t,r){return e[t](r?"disable":"enable")},overlap:function(){function e(e,t,r){return void 0===r||null===r?t:$(r)?Object.merge(t,r,!1):r}if(!arguments.length)return{};if(1===arguments.length)return arguments[0];for(var t=1;t<arguments.length;t++)Object.merge(arguments[0],arguments[t],!1,e);return arguments[0]},patch:function t(e,r){for(var n in r)r.hasOwnProperty(n)&&($(r[n])?e.hasOwnProperty(n)?t(e[n],r[n]):e[n]=Object.clone(r[n],!0):e.hasOwnProperty(n)||(e[n]=R(r[n])?r[n].clone(!0):r[n]));return e},kickoff:function(e,t){var r,n=t&&"object"==typeof t?Object.clone(t,!0):{};for(r in e)e.hasOwnProperty(r)&&(delete e[r],void 0!==n[r]&&(e[r]=n[r]))},sdbmCode:function(e){for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++)r=t.charCodeAt(n)+(r<<6)+(r<<16)-r;return(1e11+r).toString(36)},tojson:function(){function e(e){return 10>e?"0"+e:e}function t(e,a,o){var s,l,c,u,d=0,f=a||0,m=n;switch(o&&P(o)&&(d=String(o).length,m=String(o).repeat(10)),(typeof e).substr(0,3)){case"str":return i(e);case"num":return isFinite(e)?""+String(e):"null";case"boo":case"nul":return String(e);case"fun":return i(r(e.toString()));case"obj":if(!e)return"null";if(typeof e.toJSON===tt)return t(e.toJSON(),f+(o?1:0),o);if(s=[],R(e)){for(l=0;l<e.length;l+=1)s.push(t(e[l],f+(o?1:0),o)||"null");return"["+s.join(","+(o?"\n"+m.to(f*d+d):""))+"]"}for(c in e)P(c)&&(u=t(e[c],f+(o?1:0),o),u&&s.push((o?"\n"+m.to(f*d+d):"")+t(c,f+(o?1:0),o)+": "+u));return"{"+s.join(",")+(o?"\n"+m.to(f*d):"")+"}"}}function r(e){var t=/\)([\s\n\t]+?|\/\/*.*?\*\/|\/\/[^\n]*\n)*?\{/,r=e.split(t,1),n=r[0].from(8).replace(/[\s\n\t]+?|\/\/*.*?\*\/|\/\/[^\n]*\n/g,"")+")",i="{"+e.from(r[0].length).replace(t,"").replace(/[^\}]+$/,"");return("function "+n).replace(/^function\sanonymous/,"function ")+" "+i}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var n="	".repeat(10),i=JSON.stringify;return t.fill(void 0,0,void 0)}(),fromjson:function(e){var t=JSON.parse(e);return w(t),t},mask:function(e,t){function r(e,t){if(!$(t))return{};var n={};for(var i in t)!$(t[i])&&e.hasOwnProperty(i)?n[i]=Object.clone(e[i],!0):e.hasOwnProperty(i)&&(n[i]=$(e[i])?r(e[i],t[i]):Object.clone(e[i],!0));return n}if(!$(e))return null;var i,a=t;if(P(a))return n(e,a);if(R(a)){i=[];for(var o=0;o<a.length;o++)i[o]=P(a[o])?n(e,a[o])||null:null;return i}return $(a)?r(e,a):void 0},unmask:function(e,t,r){function i(e,t,r){var n,i,a,o=0;if(/\./.test(r))for(i=r.split(".").each(function(e,t){this[t]=String(e).compact()}),n=e;o<i.length;o++)o===i.length-1?n[i[o]]=t:(0===o?(n=e[i[0]],a=e):(a=a[i[o-1]],n=n[i[o]]),(null==n||!$(n)&&(R(n)&&!isNaN(i[o+1])&&+i[o]>-1))&&(n=a[i[o]]={}));else null!=t&&(e[r]=t);return e}var a,o,s;if(null==r?(a={},o=e,s=t):(a=e,o=t,s=r),$(o)&&$(s))return lt.mask(o,s);if(P(s)&&(s=[s],o=[o]),!R(s)||!R(a)&&!$(a))return null;if($(o)&&(o=s.reduce(function(e,t){return e.push(n(o,t)),e},[])),R(o)&&R(s)){for(var l=0;l<s.length;l++)null!=o[l]&&i(a,o[l],s[l]);return a}return null},getref:n,require:l,repo:function(){return H},restyles:function(){return J},unjson:function(e){return w(e),e},blob2base64:function(e,t,r){var n=new FileReader;n.onload=function(){t(r?n.result:n.result.split(",")[1])},n.readAsDataURL(e)},base642blob:function(e,t,r){for(var n,i=atob(e),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o),l=0;a>l;l++)s[l]=i.charCodeAt(l);return n=new Blob([s],{type:r||"application/octet-stream"}),A(t)?void t(n):n},base64:function(t,r,n){var i=(Q(t),null),a=P(t)?t:e.my.tojson(t),o=P(n)?"data:"+n+";base64,":"";if(r){try{i=decodeURIComponent(escape(window.atob(a)))}catch(s){i=null}if(null!==i&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(i))try{i=e.my.fromjson(i)}catch(s){i=null}return i}return o+window.btoa((n===!0?"ï»¿":"")+unescape(encodeURIComponent(a)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(!0).reduce(function(e,t){var r,n,i,a=t.trim();return/^[^{]+\{[^\}]+\}$/.test(a)&&(r=a.to(-1).split("{"),n=" "+r[0].trim(),i=r[1].trim(),";"!=i.last()&&(i+=";"),e[n]||(e[n]=""),e[n]+=i),e},{});return t}}}var T,S="jQuery.my 1.1.9",E=window.URL||window.webkitURL,M=!document.addEventListener,R=Object.isArray,I=Object.isBoolean,P=Object.isString,$=Object.isObject,F=Object.isNumber,U=Object.isRegExp,A=Object.isFunction,L=Object.keys,H=n(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Default manifest cache"},J=n(e,"my.f.restyles")?e.my.f.restyles():{},B=e.extend,Q=e.type,W=null,V=function(e){return null!==e&&void 0!==e},X="{yyyy}-{MM}-{dd}",K="{HH}:{mm}",G="object",Y="data",Z="array",et="string",tt="function",rt="change",nt=/^this\./,it=function(e){return!!(null!=e&&($(e)||e.jquery)&&A(e.then)&&A(e.fail)&&A(e.state))},at=function(e,t){var r,i;return P(e)?(r=e,i=n($(t)?t:H,r),"exist"===t?$(i):i?Object.clone(i,!0):null):$(e)?(i=a(e,t),$(i)?i:null):void 0===e?H._src:null===e?Object.reject(H,/^_/):null},ot=e.ajax,st={vals:{".my-form":function(e,t){if(e&&e.my){var r=e.my(Y);return Object.equal(r,t)?r:e.my(Y,t,!0)}return t||W},".hasDatepicker":function(e,t){V(t)&&e.datepicker("setDate",""==t?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(X):""},".my-tags":function(e,t){return V(t)&&(P(t)||F(t)?e.tags(Y,[t+""]):R(t)&&e.tags(Y,t)),e.tags(Y)},".ui-draggable":function(e,t){if(V(t)&&$(t)){var r={};isNaN(t.left)||(r.left=Number(t.left).ceil(2)+"px"),isNaN(t.top)||(r.top=Number(t.top).ceil(2)+"px"),(r.left||r.top)&&e.css(r)}var n=e.position();return{left:t&&!isNaN(t.left)?(1*t.left).ceil(2):n.left.ceil(2),top:t&&!isNaN(t.top)?(1*t.top).ceil(2):n.top.ceil(2)}},".my-form-list":function(t,r){function n(){var r,n,i=e(this),a=i.data("my");a&&(r=i.data("formlist"),n=r.index,r.hash=x(a.data,n)+"",r.oid=w!==x?w(a.data,n)+"":r.hash),t.trigger("check.my")}function a(e){e.data("my").locktill+k/1.3<D&&e.my("redraw")}var o,s,l,c,u,d,f,m="ui-sortable",h="."+m+"-placeholder",p=t.data("formlist")||{},y=p.generator||{},v=y.selector||">.my-form",g=y.template||"<div></div>",b=/\{/.test(g),x=y.hash||lt.sdbmCode,w=y.id||lt.sdbmCode,j=y.ext,k=y.delay||50,O=t.is("."+m),C=!!t.children(h).size(),q=[],z=[],D=Date.now(),N=t.find(O?t.sortable("option","items"):v);if(V(r)&&R(r)){if(C)return r;if(s=[],l={},N.each(function(){var t,r=e(this),n=r.data("my");n&&(s.push(n.data),(t=r.data("formlist"))&&(l[t.oid]=n.data))}),u=!1,s&&s.length===r.length)for(u=!0,o=0;o<s.length;o++)s[o]!==r[o]&&(u=!1);if((!u||j)&&(c=e.extend(!0,[],s,r),!Object.equal(s,c)||c.length!=r.length)){var _=[],T=[],S={},E={};for(z=[],o=0;o<r.length;o++)T[o]=w(r[o],o)+"",S[T[o]]=o,_[o]=(w!==x?x(r[o],o):T[o])+"";for(N.each(function(){var t=e(this),n=t.data("formlist")||{},i=n.oid;i&&S.hasOwnProperty(i)&&r[S[i]]===l[i]?E[i]=e(this):t.is(".my-form")?t.my("remove",!0):t.remove()}),o=0;o<r.length;o++)E[T[o]]?(d=E[T[o]].detach().appendTo(t),q.push(d.my("data")),_[o]!==(d.data("formlist")||{}).hash&&z.push(d)):(d=e(b?g.assign(r[o]):g).appendTo(t),d.data("formlist",{list:r[o],index:o,hash:_[o],oid:T[o]}),d.my(i(y.parent,y.manifest,r[o],o,r,t),r[o]).then(function(e){e.on("change.my",n.debounce(k/1.3))}.fill(d)),q.push(d.my("data")));if(z.length&&j){for(o=0;o<z.length;o++)a(z[o]);z=[]}return s=l=c=null,q}return l=c=null,s}if(N.size()){if(D-y.stamp>1.4*k||D-y.stamp>100||!y.stashed||y.stashed.length!==N.size()-(C?1:0)){C&&(f=t.find(">."+m+"-helper"));var M=0;for(N.each(function(t,r){var n,i,a,o=e(r),s=!1;C&&o.hasClass(m+"-helper")||(C&&o.hasClass(m+"-placeholder")&&(o=f),n=o.data("my"),i=o.data("formlist"),n&&i&&(q.push(n.data),M!=i.index&&(i.index=M,s=!0),j&&(a=x(n.data,M)+"",a!==i.hash&&(i.hash=a,s=!0)),M+=1,s&&z.push(o)))}),o=0;o<z.length;o++)a(z[o]);z=[],y.stamp=D,y.stashed=q}else q=y.stashed.slice(0);return q}return r||[]},".ui-sortable":function(t,r){var n,i=[],a="ui-sortable",o=">."+a+"-placeholder",s=t.find(t.sortable("option","items"));if(V(r)&&R(r)){var l={},c={},u=r.unique();if(t.find("input:focus:eq(0),textarea:focus:eq(0)").size()||t.find(o).size())return u;s.each(function(){l[lt.sdbmCode(lt.extval(e(this)))]=e(this)});for(var d=u.length-1;d>=0;d--){var f=lt.sdbmCode(u[d]);l[f]&&(l[f].prependTo(t).show(),c[f]=!0,-1==i.indexOf(u[d])&&i.push(u[d]))}i=i.reverse();for(d in l)c[d]||l[d].hide()}else{var m=t.find(o),h=t.eq(0);0!=m.size()?(h.my()[a]!=m.position().left+""+m.position().top?(s=s.filter(":visible:not(:disabled, .ui-state-disabled, .ui-sortable-helper)"),n=t.find(t.sortable("option","items")).filter(".ui-sortable-helper"),s.each(function(){var t=e(this);i.push(lt.extval(t.is(".ui-sortable-placeholder")?n:t))}),h.my()[a]=m.position().left+""+m.position().top,h.my()[a+"1"]=i):i=h.my()[a+"1"],i==W&&s.each(function(){i.push(lt.extval(e(this)))})):(s=t.find(t.sortable("option","items")).filter(":visible:not(:disabled, .ui-state-disabled)"),s.each(function(){i.push(lt.extval(e(this)))}))}return i},"input[type=date]":function(e,t){if(V(t))return r=""!=t?Date.create(t).format(X):"",P(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(X):""},"input[type=time]":function(e,t){if(V(t))return r=""!=t?Date.create(t).format(K):"",P(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(K):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){V(t)&&e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){V(t)&&e.val(t).trigger("update")},"div.select2-container+input":function(e,t){return V(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val"))&&e.select2("val",R(t)?t:[t]),e.select2("val")},"":function(e,t){V(t)&&e.val(t+"")}},":radio":function(t,r){var n=-1;if(V(r)){t.each(function(t){var i=e(this).val();r+""==i+""&&(n=t)});var i=t.eq(0).checkboxradio;if(i&&t.each(function(t){var r=e(this);n!=t&&r.is(":checked")&&r.prop("checked",!1).checkboxradio("refresh")}),n>-1){var a=t.eq(n);a.is(":checked")||(a.prop("checked",!0),i&&a.checkboxradio("refresh"))}else i||t.each(function(){e(this).prop("checked",!1)})}if(-1==n)for(var o=0;o<t.size();o++)t.eq(o).is(":checked")&&(n=o);return-1!=n?t.eq(n).val():""},":checkbox":function(t,r){var n=r,i=[];if(V(n)){R(n)||(n=[r]);var a=!!t.eq(0).checkboxradio;t.each(function(){var t=e(this),r=t.val(),o=t.is(":checked");-1!=n.indexOf(r)?(i.push(r),o||t.prop("checked",!0)):o&&t.prop("checked",!1),a&&t.checkboxradio("refresh")})}else t.each(function(){var t=e(this);t.is(":checked")&&i.push(t.val())});return i}},select:{".ui-slider-switch":function(e,t){V(t)&&(e.val(t+""),e.slider("refresh"))},"div.select2-container+select":{"[multiple]":function(e,t){return V(t)&&e.select2("val",R(t)?t:[t]),e.select2("val")},"":function(e,t){return V(t)&&e.select2("val",t+""),e.select2("val")}},"[multiple]":function(e,t){V(t)&&(e.val(t,[]),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))},"":function(e,t){V(t)&&(e.val(t+""),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))}},textarea:{".my-cleditor":function(e,t){return V(t)&&e.val(t).cleditor()[0].updateFrame(),e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");return V(t)?(r?e.redactor("set",t):e.setCode(t,!1),t):r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){return V(t)?(e[0].nextSibling.CodeMirror.setValue(t),t):e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){V(t)&&e.val(t+"")}},"fieldset,form,section,footer,aside,.my-container":function(e,t){var r=Array.prototype.slice.call(e[0],0).sort(),n=t;return V(t)&&(P(t)&&(n=t.split(/[,\s]+/).compact(!0)),R(n)&&(n.sort(),n.join(" ")!==r.join(" ")&&(e.atrr("css",n.join(" ")),r=n))),r},"div,span,a,p,li,td,th,h1,h2,h3,h4,h5,h6":{".ui-slider":function(e,t){return V(t)&&e.slider("option",e.slider("option","values")?"values":"value",lt.clone(t)),lt.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,r){if(V(r)){if(""!=r){var n=W;if(t.find(":radio").each(function(){n=(e(this).val()||e(this).button("option","label"))==r?e(this):n}),n)return n.attr("checked",!0),t.buttonset("refresh"),r}}else{var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}return t.find(":radio:checked").attr("checked",!1),t.buttonset("refresh"),""},".ace_editor":function(e,t){return V(t)&&ace.edit(e[0]).setValue(t),ace.edit(e[0]).getValue(t)},"":function(e,t){return V(t)&&e.html(t),e.html()}},"pre,code":function(e,t){return V(t)&&e.html(t),e.html()},img:function(e,t){return V(t)&&e.attr("src",t),e.attr("src")||""},"":function(e,t){return V(t)&&e.html(t),e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:T="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:T},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+("Micro"===navigator.appName.to(5)?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var r=t[0].parentNode,n=r.nodeName;return/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n)?e(r):t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)
},".ui-selectable":function(e,t){lt.jquix(t,"selectable",e)},".ui-slider":function(e,t){lt.jquix(t,"slider",e)},".ui-draggable":function(e,t){lt.jquix(t,"draggable",e)},".ui-buttonset":function(e,t){lt.jquix(t,"buttonset",e)},".hasDatepicker":function(e,t){lt.jquix(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){lt.jquix(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")}),t.removeClass("my-form-list"),t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor(),e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea(),e.removeClass("my-codemirror")}}}};st.params={container:function(e){return u(e,st.containers)(e)},change:W,recalcDepth:2,delay:0,strict:!1,restyle:-1,locale:T=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(st.msg,function(e,t){return t[T]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,r){return t?e.fadeIn(r):void e.fadeOut(r)},remember:0,silent:!1,history:{},historyDelay:100,loader:function(t){var r=e.Deferred(),n=at(t+"");return n?r.resolve(n):r.reject(null),r.promise()},ajaxTimeout:1e4};var lt=_(),ct={init:function(i,a,l){function u(e){var t,r,i,a,o,s,l={},c=!0,u=e.inherit;if(l=D(u),!Object.size(l))return null;if(a=dt.parents(".my-form").eq(0),!a.size())return null;if(o=a.data("my"),!o||!o.manifest)return null;i=o.manifest,r=i.expose,c=!r;for(t in l)(c||r[t])&&(s=n(i,t),null!=s&&(/\./.test(t)||P(l[t])?B(!0,I,lt.unmask(s,P(l[t])?l[t]:t)):e[t]=s))}function f(){var e,r;for(var e in et)for(r in M[e].listen)et[e].addClass("my-listen-"+lt.sdbmCode(r));K.radio&&dt.on("radio.my",function(e,r){var n,i;if($(r)&&r.channel&&r.message&&A(K.radio[r.channel])){n=K.radio[r.channel];try{i=n.call(K,e,r)}catch(a){t("Radio handler for form "+T+"failed",a.message,a.stack)}void 0!==i&&(e.stopPropagation(),i&&s(dt,r))}})}function m(){R.strict||w(I,!0),K=B(!0,K,Object.reject(I,["data"])),M=q(B(!0,{},I.ui||{}),K,R),K.radio&&(K.radio=z(K.radio)),K.expose&&(K.expose=D(K.expose)),_=Number.random(268435456,4294967295).toString(16),C=I.id||"my"+_,T=lt.sdbmCode(C),K.id=C,R.form=dt,I.params&&I.params.depth&&(R.recalcDepth=I.params.depth);for(F in K)A(K[F])&&(K[F]=K[F].bind(K));I.error&&(P(K.error)?nt=function(e,t){return K.error.assign(B({message:e+"",err:t+""},K))}:A(I.error)&&(nt=function(e,t){S=null;try{S=I.error(e,t)}catch(r){S=R.messages.initFailed}return S})),B(dt.data("my"),{id:C,cid:_,mid:T,errors:Object.extended(),ui:Object.extended(M),disabled:!1,manifest:K,locFiles:[],modals:{},radio:{}}),dt.addClass("my-form"),L="my-manifest-"+T,H="my-form-"+_,dt.addClass(H+" "+L)}function h(t){function r(e,t){return'<style id="'+t+'" data-count="0">.'+t+e.join(" \n."+t)+"\n</style>"}!K.style||t&&!dt.is(":visible")||(U=N(dt,K,L,H),U&&U[0].length&&!t&&(Q=e("style#"+L),Q.size()||(Q=e(r(U[0],L)).appendTo(e("body"))),Q.data("count",1*Q.data("count")+1),dt.data("my").style=Q),U&&U[1].length&&(V=e("style#"+H),V.size()?t&&(e(r(U[1],H)).replaceAll(V),V=e("style#"+H)):(V=e(r(U[1],H)).appendTo(e("body")),R.restyle>-1&&!J[_]&&(J[_]=function(){h(!0)}.debounce(R.restyle)),dt.data("my").restyle=h.fill(!0).debounce(0)),dt.data("my").localStyle=V,t||dt.addClass("my-restyle")))}function p(){var t,r,n=e.Deferred();if(r=o(K),P(r))j("Error decoding base64 to local Blob/URL",r),n.reject();else{if(E)for(t=0;t<r.length;t++)Z.push(K.files[r[t]].url);Z.length&&(dt.data("my").locFiles=Z),n.resolve()}return n.promise()}function y(){if(I.init!=W){ut=dt.find(">*").clone();try{X=x(K,I.init,dt,I)}catch(t){return j(P(t)?t:t.message,t.stack),dt}}if(it(X)?X.then(function(){g()},function(e,t){j(e,t)}):g(),!rt){if(!dt.my())return j("Internal error initializing controls.",""),dt;dt.data("my").initial=B(!0,{},G),e.mobile&&e.mobile.changePage(e.mobile.activePage)}}function g(){function e(e){rt||(t[e]=c(dt.find(e),W),r-=1,.5>r&&b(t))}var t={},r=Object.size(M);dt.addClass(ot),Object.each(M,function(t){if(!rt){var r=dt.find(t),n=v(r,dt,M[t],t);it(n)?n.then(e.fill(t)).fail(function(e,r){j("Error building "+t+", "+e,r)}):rt||e(t)}})}function b(e){var r,n,i;for(var a in M){if(rt)return;if(r=M[a],i=dt.find(a),i.size()){r.listen&&(et[a]=i.eq(0));try{n=d(G,W,r,i),n==W&&e[a]!=W&&void 0!==n&&d(G,e[a],r,i)}catch(o){t("Transient fail linking "+a+" of form $('.my-form-"+_+"')",o.message,o.stack)}try{n!=W&&c(i,n),i.eq(0).trigger("check.my")}catch(o){j("Error linking "+a,o.message,o.stack)}}}dt.removeClass(ot),dt.on("recalc.my, redraw.my",function(e){e.stopPropagation(),dt.my("redraw")}),ut=null,tt.resolve(G)}function j(e,r){var n;if(rt=!0,t("Form "+C+" failed to initialize.",e,r),dt.removeClass(ot),n=nt(e,r),P(n)||$(n)&&n.jquery?dt.html(n):n===!0&&dt.html(ut),R.silent)tt.resolve(G);else{if(!dt.my().ddata){if(dt.removeData("my"),dt.removeClass("my-form"),Q)if("1"==Q.data("count"))try{Q.remove()}catch(i){}else Q.data("count",Q.data("count")-1);if(V)try{delete J[_],V.remove()}catch(i){}}tt.reject("Form "+C+" failed to initialize: "+e,r)}}var k,O,C,_,T,S,M,R,I,F,U,L,H,Q,V,X,K={},G={},Z=[],et={},tt=e.Deferred(),rt=!1,nt=function(){},ot="my-form-init",ct="std",ut="";if(P(i)){if(k=at(i),!k)return tt.reject("No manifest with id "+i+" found in repo."),tt.promise();$(l)&&$(a)?(k=B(k,a),O=l):O=a,ct="repo"}else k=i,O=a;if(!k)return this;I=$(O)&&"repo"!=ct?B(!0,{},k):k;var dt=this.eq(0),ft=dt.my();return $(ft)&&ft.id&&ft.ui?(r("jQuery.my is already bound.",dt),dt.my("ui",I.ui),dt.my(Y,I.data),tt.resolve(dt.my(Y)).promise()):(R=I.params||{},R.strict||(R=B(!0,{},R),w(R)),R=B(!0,{},st.params,R),tt.fail(function(){dt.removeClass(H+" "+L)}),B(dt,tt.promise()),$(O)?(G=lt.patch(O,I.data||{}),I.data=G):G=I.data||{},K.data=G,dt.data("my",{data:G,params:R,promise:tt.promise(),locktill:0}),dt.addClass(ot),I.inherit&&u(I),lt.require(I,R).then(function(){m(),p().then(function(){h(),y()})}).fail(function(e){m(),j("Linker of ‘require’ property failed.",e)}),tt.then(f),dt)},redraw:function(e,t){var r=this,n=r.my();return n&&n.ui&&(n.ui.each(function(t){var i=r.find(t);p(i,e?W:void 0,n.params.recalcDepth),e||(i.is(".my-form")&&i.my("redraw"),i.trigger(i.is(".my-form-list")?"redraw":"check.my"))}),!t&&e&&r.trigger(rt)),r},data:function(e,t){var r=this;return $(e)&&(r.my().data=lt.overlap(r.my().data,e),this.my("redraw",t)),r.my().data},errors:function(){var t=e(this).my().errors,r={};for(var n in t)t[n]&&P(t[n])&&(r[n]=t[n]),$(t[n])&&L(t[n]).length&&(r[n]=t[n]);return r},valid:function(){var t=e(this).my().errors,r=0;for(var n in t)t[n]&&P(t[n])?r++:$(t[n])&&L(t[n]).length&&r++;return!r},reset:function(){try{lt.kickoff(this.my().data,this.my().initial),this.my("redraw")}catch(e){return!1}return!0},id:function(e,t){if(P(e))return at(e,t);var r=this.my();return r&&r.id?r.id:W},remove:function(e){var t,r,n,i,a,o,s,l,c=this;if(!this.my())return W;if(this.my().root&&!this.my().ddata&&(c=this.my().root),n=c.my(),a=n.data,s=n.cid,l=n.mid,c.unbind(".my"),$(n)&&n.manifest&&A(n.manifest.die))try{n.manifest.die.call(n.manifest,c,n.manifest)}catch(d){}if(t=n.style)if("1"==t.data("count"))try{t.remove()}catch(d){}else t.data("count",t.data("count")-1);if(r=n.localStyle)try{delete J[s],r.remove()}catch(d){}if(window.URL&&(i=n.locFiles)&&i.length)for(var f=0;f<i.length;f++)try{URL.revokeObjectURL(i[f])}catch(d){}if(o=(n||{}).ui,o&&o.each(function(e){var t,r,n,i=c.find(e);if((r=i.data("modal"))&&(r.cancel(),i.removeData("modal")),r=i.data("modals"))for(n in r)r[n]&&r[n].cancel();i.unbind(".my");try{t=u(i,st.destroy),A(t)&&t(i)}catch(a){}i.removeData("formlist").removeData("myval").removeData("my")}),e&&c.is(".my-form"))c.remove();else if(c.data("formlist")&&c.is(".my-form")){var m=c.parents(".my-form-list").eq(0);c.remove(),m.trigger("check")}else c.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form");return c.removeClass("my-form-"+s+" my-manifest-"+l),a},undo:function(e){var t,r=this,n=r.my(),i=n.params.history,a=L(i).sort(),o=1*(parseInt(e)||0);return!a.length||0>o?W:(n.params.errors&&n.params.errors.values().compact(!0).length?Object.equal(n.data,n.lastCorrect)||(o+=1):Object.equal(i[a.last()],n.data)&&(o+=1),t=y(o,n.params,!0),t&&(lt.kickoff(r.my().data,t),r.my("redraw")),r.my().data)},ui:function(e){var t,r=this,n=r.my(),i=[];if(!n)return W;B(!0,{},n.ui);if(!$(e))return n.ui;for(t in e)i.push(t);for(n.ui=q(lt.overlap(n.ui,e)),t=0;t<i.length;t++)v(r.find(i[t]),r,n.ui[i[t]],i[t]);for(t in e)r.find(t).eq(0).trigger("check");return n.ui},disabled:function(e){var t,r,n,i,a=this,o=a.my();if(!o)return void 0;if(e==W)return o.disabled;if(e){for(r in o.ui)t=a.find(r).eq(0),n=t.my(),n&&(n.predisabled=n.disabled),h(!0,t,":disabled");a.addClass("my-disabled")}else{for(r in o.ui)t=a.find(r).eq(0),n=t.my(),i=!1,n&&n.predisabled&&(i=!0),h(i,t,":disabled");a.removeClass("my-disabled"),a.my("redraw")}},find:function(e){var t=this,r=t.my();return r&&r.root&&(t=r.root),t.find(e)},radio:function(e,t){this.trigger("radio",P(e)?{channel:e,message:t}:e)},manifest:function(e){return"json"==e?lt.tojson(this.my().manifest):this.my().manifest},version:function(){return S},history:function(e,t){return y(e,this.my().params,t)},val:function(e){return c(this,e)},container:function(e){return u(e,st.containers)(e)},promise:function(e){return A(e)&&this.my().promise.then(e),this.my().promise},restyle:function(t){var r,n,i=[],a=this.is(".my-form")?this:this.parents(".my-form").eq(0);if(a.size()&&a.is(":visible")){for(n=(a.data("my")||{}).cid,n&&i.push(n),t||a.find(".my-restyle").each(function(){var t=e(this),r=(t.data("my")||{}).cid;r&&i.push(r)}),r=0;r<i.length;r++)if(J[i[r]])try{J[i[r]]()}catch(o){}return!!i.length}return!1},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},insert:function(e,t){var r,i,a=this.is(".my-form-list")?this:this.my().root||this,o=a.is(".my-form-list")?a:a.parent(".my-form-list"),s=(a.data("formlist")||{}).index,l=t;if(null==s&&(s=0),r=n(o.my().data,o.data("formlist").generator.bind),!$(l))if($(o.data("formlist").generator.manifest))l=Object.clone(o.data("formlist").generator.manifest.data,!0)||{};else{if(o===a)throw"No data to insert, cannot guess when manifest is function.";l=Object.clone(a.my().manifest.data,!0)}if("before"===e)i=s;else if("after"===e)i=s+1;else{if(isNaN(e))throw"Invalid position for insert";i=(1*e).clamp(0,r.length)}r.add(l,i),o.trigger("redraw")}};e.my||(e.my={}),e.extend(e.my,{f:e.extend({},lt),tojson:lt.tojson,fromjson:lt.fromjson,radio:function(t,r){s(e(document),P(t)?{channel:t,message:r}:t)},rules:st,cache:function(e,t){return A(e)?at=e:at(e,t)},version:function(){return S},ajax:function(e){return A(e)?ot=e:ot.apply(this,Array.prototype.slice.call(arguments))}}),e.my.chain=function(){function e(){if(n.length&&i){var t,r=n.shift(),a=function(){e.delay(r[1])}.once();try{t=r[0]()}catch(o){a()}it(t)?(t.then(a,a),a.delay(r[1])):a()}}var t=1,r=1e3,n=[],i=!1,a=function(i,a,o){n.push([i,a||t,o||r]),e()};return a.delay=function(e){return isNaN(e)||(t=(e-0).clamp(0,1e6)),t},a.timeout=function(e){return isNaN(e)||(r=(e-0).clamp(1,1e6)),r},a.start=function(){i=!0,e()},a.stop=function(){i=!1},a}(),e.fn.my=function(t){var r;if(void 0===t)return this.data("my");if(P(t)&&"{"==t.substr(0,1)){try{r=JSON.parse(t)}catch(n){}if(r)return ct.init.apply(this,[r].add(Array.prototype.slice.call(arguments,1)))}return P(t)&&ct[t]?ct[t].apply(this,Array.prototype.slice.call(arguments,1)):P(t)&&at(t,"exist")?ct.init.apply(this,arguments):typeof t!==G&&t?void e.error("Method "+t+" does not exist on jQuery.my"):ct.init.apply(this,arguments)},e(window).off(".my").on("radio.my",function(t,r){t.stopPropagation(),s(e(document),r)}).on("resize.my",function(){for(var e in J)try{J[e]()}catch(t){}}.debounce(100))}(jQuery),function(e){function t(e,t,r){if(l(t))return e+t;if(c(t))return r=i(!0,r,t),e;if(s(t)&&t.length>1&&l(t[1])){for(var n,u,f,m,h,p,y,v,g=t[0],b="",x=1;x<t.length;){if(l(t[x]))if(m=t[x].replace(/\s/g,""),f=m.split(/[\.#]/i),u=r.alias[f[0]]||f[0],n=m.substr(f[0].length),/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(m)){y=d.tmpl[u]||d.tmpl[""],p={style:"","class":"",txt:""},v="";var w=c(t[x+1]);if(w){x+=1;for(h in t[x])""!==d.attnames[h]&&(p[d.attnames[h]||h]=t[x][h])}p.style||p["class"]||!r.styles[u]||(p.style=r.styles[u]),p.id||"#"!=n.to(1)||(p.id=n.from(1).split(".")[0]),!p["class"]&&/\./.test(n)&&(p["class"]=("#"==n.to(1)?n.substr(p.id.length+1):n).split(".").compact(!0).join(" "));for(h in p)v+=h+'="'+p[h]+'" ';if(w)for(h in t[x])""===d.attnames[h]&&(p[h]=t[x][h]);p.ext=v,!p.txt&&d.txt[u]&&(p.txt=d.txt[u](p)),p._tag=u,b+=typeof y==o?y(p)||"":typeof y==a?y.assign(p):""}else b+=t[x];x+=1}return b&&(b="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&g?"padding-left:"+r.label+"; ":"")+'">'+(g?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+g+"</"+r.labelTag+">":"")+b+"</"+r.rowTag+">"),e+b}return e}function r(e){var t=e;if(l(t)&&(t=t.split(/[\s,]/).compact(!0)),s(t)){for(var r={},n=0;n<t.length;n++){var i=t[n];if(c(i)){var a=Object.keys(i);1==a.length?r[a[0]]=i[a[0]]+"":r[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else r[i]=i+""}t=r}return c(t)?t:{}}function n(r,n){var a={};return s(r)?(i(!0,a,d.params,n||{}),r.length?r.reduce(t.fill(void 0,void 0,a),""):""):c(r)?void e.extend(d,r):""}var i=e.extend,a="string",o="function",s=Object.isArray,l=(Object.isBoolean,Object.isString),c=Object.isObject,u=(Object.isNumber,Object.isRegExp,Object.isFunction,'<input type="'),d={tmpl:{num:u+'number" {ext}/>',inp:u+'text" {ext}/>',sli:u+'range" {ext}/>',dat:u+'date" {ext}/>',btn:u+'button" {ext}/>',pwd:u+'password" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!s(e.vals))return"";var t=i({style:"",css:""},e);return t.txt=e.vals.reduce(function(e,t){return e+"<span class=\"my-shortcut\" onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," "),'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(t)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=r(e.vals);return Object.keys(t).reduce(function(e,r){return e+'<option value="'+r+'">'+t[r]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",pwd:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}},f={init:function(t,r){return e(this).html(n(t,r))}};e.my||(e.my={}),e.my.formgen=n,e.fn.formgen=function(t){return l(t)&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.formgen"):f.init.apply(this,arguments)}}(jQuery),function(e){function t(t,r,n,i){var a,s,l,d,f,m,h;if("object"==typeof r&&r.jquery)r.is("img")&&(m=r,f=r.attr("alt")||r.attr("title")||r.data("text")||"",s=m[0].naturalWidth||m[0].width,a=m[0].naturalHeight||m[0].height,1>a&&(a=1),1>s&&(s=1),d=e(window).width()-90,l=e(window).height()-90,a>l&&(s=s*(l/a)|0,a=l),s>d&&(s=d,a=a*(d/s)|0),h=300>s?300:s,o(t,{source:"image",manifest:{init:function(e){e.html(this.HTML),e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+s+"px;max-height:"+a+'px"><h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:m.attr("src"),text:f},esc:!0,screen:!0,width:i||h,focus:!1,global:!0,z:"1995"},n));else if(u(r)&&r.manifest)o(t,r,n);else{if(!c(r))return null;o(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:r,ui:{"div:eq(0)":function(){}}},data:{},esc:!0,focus:!1,width:i},n)}return t}var r,n={},i="body",a=!1,o=e.extend,s={},l=(Object.isArray,Object.isBoolean),c=Object.isString,u=Object.isObject,d=Object.isNumber,f=(Object.isRegExp,Object.isFunction);e(document).keydown(function(e){var t,r,n=e.keyCode;if(!1!==a&&(13===n||27===n)){if(r=a.data("modal"),t=r.form,27==n&&(r.esc||Object.equal(t.data("my").initial,t.my("data"))))return a.modal(!0),!1;if(13==n&&r.enter)return function(e){e.modal()}.fill(a).delay(50),!1}}),n.modal=function(r,n,o){var s,c={},u=e(i),d=u.find(">.my-modal-proxy"),m={global:!0,screen:!0,done:f(n)?n:void 0,z:"1995"};return l(r)||null==r?d.modal(r):(s=e.Deferred(),t(c,r,m,o)?a?s.reject("Locked").promise():(d.size()||(d=e('<div class="my-modal-proxy"></div>').prependTo(u),d.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})),d.modal(c)):s.reject("Invalid data").promise())},n.modal.loading=function(t){e(i).find(">.my-modal").toggleClass("my-modal-loading",!!t)},n.modal.parent=function(t){return t&&e(t).size()?void(i=t):e(i)},n.modal.parentBack=function(t){return t&&e(t).size()?void(r=t):e(r||i)},n.modal.visible=function(){return!!a},e.my||(e.my={}),e.my.modal=n.modal,e.fn.modal=function(n,m,h){function p(){var t,r,n=window,i=!!E.global,a=w.offset(),o=D.offset(),s=w.scrollTop();E.pos={px:a.left,py:a.top,pw:w.outerWidth(),ph:w.outerHeight(),ox:o.left,oy:o.top,ow:D.outerWidth(),oh:D.outerHeight(),ww:r,wh:t};var l=1*(E.x.match(/\-?\d+(\.\d+)?/)||[0])[0],c=1*(E.y.match(/\-?\d+(\.\d+)?/)||[0])[0],u=E.x.has("left")?-1:E.x.has("right")?1:0,f=E.y.has("top")?-1:E.y.has("bottom")?1:0,m=E.pos.ox+E.pos.ow/2-E.pos.px,h=E.pos.oy+E.pos.oh/2-E.pos.py;if(i&&(E.pos.wh=t=n.innerHeight||e(n).height(),E.pos.ww=r=n.innerWidth||e(n).width(),m=r/2,h=t/2.5),l=E.x.has("%")?E.pos.ow/100*l:l,c=E.y.has("%")?E.pos.oh/100*c:c,E.pos.pix=m,E.pos.piy=h,m=m+u*(E.pos.ow/2)+l*(u>0?-1:1)-(E.width+N)*(u+1)/2,i?(h=(t-E.height-20)/3,10>h&&(h=10)):h=h+f*(E.pos.oh/2)+c*(f>0?-1:1)-(E.height||0)*(f+1)/2,m=m.round(1),h=(h+s).round(1),E.pos.vx=m,E.pos.vy=h,E.bound!==!1&&!E.global){var p=(d(E.bound)?E.bound:0).clamp(-100,100);E.pos.pw-2*p<E.width+N?E.pos.vx=-(E.width+N-E.pos.pw)/2:E.pos.vx+E.width+N>E.pos.pw-p?E.pos.vx=E.pos.pw-p-E.width-N:E.pos.vx<p&&(E.pos.vx=p),E.pos.ph-2*p<E.height?(E.pos.vy=p,E.height=E.pos.ph-2*p):E.pos.vy+E.height>E.pos.ph-p?E.pos.vy=E.pos.ph-p-E.height:E.pos.vy<p&&(E.pos.vy=p)}}function y(t){if(t||(E.height=b.outerHeight(),"manifest"!==E.source&&(E.width=b.width()),p()),b.css({width:E.width+N+"px",display:"block"}),E.global)b.css({left:"50%","margin-left":"-"+((E.width+N)/2).round(0)+"px"});else if(b.css({left:E.pos.vx+"px"}),E.nose){e("style#my-modal-style-"+E.cid).size()||b.append('<style id="my-modal-style-'+E.cid+'"></style>');var r="",n=e("style#my-modal-style-"+E.cid);("top"==E.nose||"bottom"==E.nose)&&(r+="div.my-modal-"+E.cid+".nose-"+E.nose+":before {left:"+(E.pos.ox-E.pos.px+E.pos.ow/2-E.pos.vx)+"px!important;}",n.text(r)),("left"==E.nose||"right"==E.nose)&&(r+="div.my-modal-"+E.cid+".nose-"+E.nose+":before {top:"+(E.pos.oy-E.pos.py+E.pos.oh/2-E.pos.vy)+"px!important;}",n.text(r))}E.screen?E.global?(j.css({top:0,left:0,width:2*E.pos.ww+"px",height:2*E.pos.wh+"px",display:"block",position:"fixed","z-index":E.z-1}),c(E.screen)&&j.css({background:E.screen?E.screen:"rgba(25, 39, 59, 0.88)"})):j.css({top:0,left:0,position:"absolute",width:E.pos.pw+"px",height:E.pos.ph+"px",display:"block",background:c(E.screen)?E.screen:"rgba(40,80,120,0.6)","z-index":E.z-1}):j.size()&&j.hide(),E.height>E.pos.wh?(b.height(E.pos.wh-30),x.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})):x.css({"overflow-y":"none"}),b.animate({top:E.pos.vy+"px",opacity:"1"},E.animate)}function v(){try{x.my("remove")}catch(t){}try{w.data("modals")[E.cid]=null}catch(t){}x.parent().unbind(".my").remove(),j.off(".my"+E.cid),E.screen&&function(e){e&&a||j.hide(),e&&!a&&j.css({background:"rgba(25, 39, 59, 0.88)"})}.delay(50,E.global),E.global&&(a=!1,e("body").css({overflow:"auto"}))}function g(e){try{T(null,null)}catch(t){}(function(){q.reject(e)}).delay(0)}var b,x,w,j,k,O,C,q=e.Deferred(),z={},D=this,N=0,_=0,T=f(m)?m:function(){return!1},S=u(n)?n:{},E=D.data("modal");if(o(D,q.promise()),E){if(null==n||l(n)){if(x=E.form,j=E.bg,w=E.root,T=E.done,O=x.my("data"),C=!1,n){try{T(null,null)}catch(M){}if(v(),D.removeData("modal"),s[E.cid])try{s[E.cid].reject("Cancelled")}catch(M){}delete s[E.cid],E=null}else{try{C=T(x.my("valid")?null:x.my("errors"),O)}catch(M){}C||(v(),D.removeData("modal"),function(){s[E.cid]&&s[E.cid].resolve(O),delete s[E.cid],E=null}.delay(0))}return D}if(S)return g("Locked"),D}return D.is(":visible")?(S=t(z,n,{}))?S.global&&a?(g("Locked"),D):(E=o({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:D,manifest:{},data:{},global:!1,screen:!1,drag:!1,focus:!0,close:!0,silent:!0,esc:!1,enter:!1,bound:!1,nose:"",width:h||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},S,{promise:q.promise(),cid:Number.random(268435456,4294967295).toString(16)}),E.done=f(E.done)?E.done:T,c(E.align)&&E.align&&(E.x=(E.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0],E.y=(E.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]),E.width=1*(e.my.f.getref(c(E.manifest)?e.my.cache(E.manifest):E.manifest,"params.width")||E.width),E.type="DOM",D.hasClass("my-form")?(E.type="form",E.root=E.root||D):D.data("my")?(E.type="control",E.root=E.root||D.my().root):(E.root=E.root||D.parents(".my-form").eq(0),E.root.size()||(E.root=e(i))),E.global?(E.root=e(i),E.bgroot=e(r||i)):E.bgroot=E.root,w=E.root,w.data("modals")||w.data("modals",{}),p(),b=e('<div class="my-modal my-modal-'+(E.global?"fullscreen ":"overlay ")+E.css+(E.nose?" nose-"+E.nose:"")+'"></div>').prependTo(E.root),b.addClass("my-modal-"+E.cid),N=b.outerWidth(),_=b.outerHeight(),b.hide(),b.html('<div class="my-modal-form"></div>'),x=b.find(".my-modal-form"),E.close&&(k=e(c(E.close)?E.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(b).on("click.my",function(){D.modal(!0)}),k.css({"z-index":("+"===(E.z+"").to(1)?"+":"")+(1*E.z+1)})),j=E.bgroot.find(">.my-modal-screen"),E.screen&&(j.size()||(j=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(E.root)),E.esc&&j.on("click.my"+E.cid,function(){D.modal(!0)})),D.data("modal",E),E.silent&&b.on("change.my",function(){return!1}),b.css({display:"block",height:"none",opacity:"0.005","z-index":E.z,width:"auto"}),b.css(E.global?{position:"fixed",left:"50%",top:E.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":E.z,width:"auto","margin-left":"-"+((E.width+N)/2).round(0)+"px"}:{position:"absolute",left:E.pos.vx+"px",top:E.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":E.z,width:"auto"}),x.my(E.manifest,E.data).then(function(){var t,r,n,i,l;if(o(E,{form:x,bg:j,cancel:function(){D.modal(!0)},commit:function(){D.modal()}}),b.data("modal",E),E.height=b.outerHeight(),"manifest"!==E.source&&(E.width=b.width()),p(),b.css({top:E.pos.vy+"px"}),y(!0),w.data("modals")[E.cid]=E,s[E.cid]=q,x.bind("commit.my",function(){return E.commit.delay(50),!1}).bind("cancel.my",function(){return E.cancel.delay(50),!1}),b.bind("layout.my",function(){y()}.debounce(50)),E.global&&(a=D,e("body").css({overflow:"hidden"})),E.global||!E.esc&&!E.enter||x.bind("keydown.my",function(t){var r=t.keyCode;return 27==r&&E.esc?(E.cancel(),!1):13==r&&E.enter&&!e(t.target).is("textarea")?(E.commit.delay(50),!1):void 0}),E.focus===!0){i=!1,l=E.manifest.ui;for(n in l)i||(r=x.find(n),r.size()&&r.is("input, textarea","button")&&(i=!0,r.focus()))}else c(E.focus)&&x.find(E.focus).focus();if(t=x.find("img").filter(function(){return""!=e(this).attr("src")}),t.size()){var u=function(){"manifest"!==E.source&&b.css({width:"auto"}),y()}.after(t.size());t.each(function(){e(this).bind("load",u)})}E.drag&&e.fn.draggable&&(c(E.drag)?b.draggable({handle:E.drag}):b.draggable(),E.nose&&b.on("dragstart.my",function(){b.removeClass("nose-"+E.nose)})),q.notify("Ready")}).fail(function(e){v(),D.data("modal",null),q.reject(e)}),D):(g("Invalid data"),D):(g("Object must be visible"),D)}}(jQuery);